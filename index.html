<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¦è¸æ—…éŠ USC tours - æœƒå“¡ç³»çµ±ç‰ˆ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root {
            --main-red: #C01B21;
            --dark-gray: #333;
        }

        body {
            font-family: "Microsoft JhengHei", sans-serif;
            color: var(--dark-gray);
            background-color: #fff;
        }

        /* Navbar */
        .navbar {
            border-bottom: 1px solid #eee;
            padding: 15px 0;
            background: #fff;
            z-index: 1050 !important;
        }

        .navbar-brand {
            color: var(--main-red) !important;
            font-weight: bold;
            text-decoration: none;
        }

        /* Banner */
        .hero-banner {
            background: url('https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?q=80&w=2070') center/cover;
            padding: 50px 0 80px 0;
            min-height: 400px;
        }

        .search-container {
            background: white;
            border-radius: 4px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.2);
            max-width: 800px;
            margin: 0 auto;
            overflow: hidden;
        }

        .nav-tabs-custom {
            display: flex;
            border-bottom: 2px solid #eee;
            background: #fff;
        }

            .nav-tabs-custom .nav-link {
                flex: 1;
                padding: 12px;
                text-align: center;
                border: none;
                background: none;
                color: #888;
                border-bottom: 3px solid transparent;
                cursor: pointer;
            }

                .nav-tabs-custom .nav-link.active {
                    color: var(--main-red);
                    border-bottom-color: var(--main-red);
                    font-weight: bold;
                }

        /* Cards */
        .section-title {
            border-left: 5px solid var(--main-red);
            padding-left: 15px;
            margin: 40px 0 25px 0;
            font-weight: bold;
        }

        .tour-card {
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: 0.3s;
            background: #fff;
        }

        .price-text {
            color: var(--main-red);
            font-size: 1.3rem;
            font-weight: bold;
        }

        /* Cart UI */
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            border-bottom: 1px solid #f1f1f1;
        }

        .total-price-row {
            padding: 15px 20px;
            text-align: right;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--main-red);
            background-color: #f9f9f9;
            border-top: 1px solid #eee;
        }

        /* Footer */
        .footer-main {
            background-color: #444;
            color: #ddd;
            padding: 50px 0 20px 0;
            font-size: 0.85rem;
        }

        .footer-title {
            color: #fff;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .footer-links ul {
            list-style: none;
            padding: 0;
        }

        .footer-links a {
            color: #bbb;
            text-decoration: none;
        }

        .copyright-bar {
            background-color: #333;
            padding: 15px 0;
            margin-top: 40px;
            border-top: 1px solid #555;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

    <nav class="navbar sticky-top shadow-sm">
        <div class="container d-flex justify-content-between align-items-center">
            <a class="navbar-brand" href="javascript:location.reload()">å¯¦è¸æ—…éŠ <span style="font-weight:300; font-size:0.9rem; color:#666;">USC tours</span></a>

            <div class="d-flex align-items-center">
                <span id="user-display" class="me-3 small fw-bold text-secondary"></span>
                <button class="btn btn-sm btn-outline-danger me-2" id="login-nav-btn" data-bs-toggle="modal" data-bs-target="#loginModal">ç™»å…¥/è¨»å†Š</button>
                <button class="btn btn-sm btn-dark me-2" id="logout-nav-btn" onclick="handleLogout()" style="display:none;">ç™»å‡º</button>

                <button class="btn btn-outline-dark position-relative" onclick="showTab('cart'); window.scrollTo({top: 0, behavior: 'smooth'});">
                    <i class="bi bi-cart3"></i>
                    <span id="cart-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
                </button>
            </div>
        </div>
    </nav>

    <section class="hero-banner">
        <div class="container">
            <div class="search-container">
                <div class="nav nav-tabs-custom">
                    <button class="nav-link active" id="tab-all-btn" onclick="showTab('all')">ç²¾é¸</button>
                    <button class="nav-link" id="tab-flight-btn" onclick="showTab('flight')">æ©Ÿç¥¨</button>
                    <button class="nav-link" id="tab-cruise-btn" onclick="showTab('cruise')">éƒµè¼ª</button>
                    <button class="nav-link" id="tab-hotel-btn" onclick="showTab('hotel')">è¨‚æˆ¿</button>
                    <button class="nav-link" id="tab-cart-btn" onclick="showTab('cart')">é é¸</button>
                </div>
                <div class="p-4">
                    <div id="search-action-area">
                        <div class="input-group border rounded overflow-hidden">
                            <input type="text" id="keyword-input" class="form-control border-0" placeholder="æœå°‹ç›®çš„åœ°æˆ–ç”¢å“åç¨±...">
                            <button class="btn btn-danger rounded-0" onclick="performSearch()">æœå°‹</button>
                        </div>
                    </div>
                    <div id="pane-cart-display" style="display:none;">
                        <div id="upper-cart-list"></div>
                        <div id="cart-total-price" class="total-price-row" style="display:none;"></div>
                        <div class="row g-2 mt-3">
                            <div class="col-6"><button class="btn btn-dark w-100 py-2">å‰å¾€çµå¸³</button></div>
                            <div class="col-6"><button class="btn btn-outline-success w-100 py-2" onclick="exportCartToCSV()"><i class="bi bi-filetype-csv"></i> åŒ¯å‡º CSV</button></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <main class="container mb-5">
        <h3 class="section-title" id="grid-title">æ‰€æœ‰æ–¹æ¡ˆç²¾é¸</h3>
        <div id="items-grid-container">
            <div class="row g-4" id="main-items-grid"></div>
        </div>
    </main>

    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content border-0 shadow">
                <div class="modal-header border-0"><h5 class="modal-title fw-bold">æœƒå“¡ç™»å…¥</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <div class="mb-2">
                        <label class="small text-muted">å¸³è™Ÿ</label>
                        <input type="text" id="login-user" class="form-control" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ">
                    </div>
                    <div class="mb-3">
                        <label class="small text-muted">å¯†ç¢¼</label>
                        <input type="password" id="login-pass" class="form-control" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
                    </div>
                    <button class="btn btn-danger w-100 mb-2" onclick="handleLogin()">ç™»å…¥</button>
                    <button class="btn btn-outline-secondary w-100" onclick="handleRegister()">è¨»å†Šæ–°å¸³è™Ÿ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="infoModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content border-0">
                <div class="modal-body p-0">
                    <div class="row g-0">
                        <div class="col-lg-7"><img id="m-image" src="" class="img-fluid w-100 h-100" style="object-fit:cover; min-height:450px;"></div>
                        <div class="col-lg-5 p-5 position-relative">
                            <button type="button" class="btn-close position-absolute top-0 end-0 m-4" data-bs-dismiss="modal"></button>
                            <h2 id="m-name" class="fw-bold mb-3"></h2>
                            <p id="m-text" class="text-muted lh-lg mb-4"></p>
                            <div class="bg-light p-4 rounded mb-4"><h2 id="m-price-val" class="text-danger fw-bold mt-1"></h2></div>
                            <div class="d-grid"><button id="m-buy-btn" class="btn btn-danger btn-lg py-3 fw-bold">åŠ å…¥é é¸æ¸…å–®</button></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer-main">
        <div class="container text-center text-md-start">
            <div class="row">
                <div class="col-md-4">
                    <div class="footer-title">é—œæ–¼å¯¦è¸æ—…éŠ</div>
                    <p class="small text-muted">æä¾›å…¨çƒæ©Ÿç¥¨ã€éƒµè¼ªã€è¨‚æˆ¿ä¸€ç«™å¼æœå‹™ã€‚</p>
                </div>
                <div class="col-md-4 text-center">
                    <div class="footer-title">è¯çµ¡æˆ‘å€‘</div>
                    <p class="small">é›»è©±: 07-667-8888</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="footer-title">Follow Us</div>
                    <div class="h3"><i class="bi bi-facebook me-2"></i><i class="bi bi-instagram"></i></div>
                </div>
            </div>
        </div>
        <div class="copyright-bar text-center">
            Copyright Â© 2025 USC TOUR Co., Ltd. All rights reserved.
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // è³‡æ–™åº«èˆ‡è®Šæ•¸åˆå§‹åŒ–
        const travelDB = [
            { id: 1, type: 'flight', name: "é•·æ¦®èˆªç©º æ±äº¬ä¾†å›æ©Ÿç¥¨", desc: "æˆç”°/ç¾½ç”°è‡ªç”±æ­é…ï¼Œæ—©å»æ™šå›ä¸æµªè²»æ™‚é–“ã€‚åŒ…å«30KGæ‰˜é‹ã€‚", price: 15800, img: "https://image.cdn-eztravel.com.tw/6MPKf53qDJqAXa6f-v71XxnU9ZxCObMqIeNo_dw7grs/g:ce/aHR0cDovL3ZhY2F0aW9uLmNkbi1lenRyYXZlbC5jb20udHcvcG9pL2pwL1RZTy9Ub2t5byBUb3dlci9zaHV0dGVyc3RvY2tfMTI5NjExMjI1X1IxNjAwLmpwZw.jpg" },
            { id: 2, type: 'flight', name: "ä¸­è¯èˆªç©º å€«æ•¦ç›´é£›æ©Ÿç¥¨", desc: "å€«æ•¦å¸Œæ–¯æ´›æ©Ÿå ´ç›´é£›ï¼Œçœå»è½‰æ©Ÿå‹ç´¯ã€‚å…¨æ–° A350 å®¢æ©Ÿæœå‹™ã€‚", price: 32500, img: "https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?w=800" },
            { id: 3, type: 'cruise', name: "æ­Œè©©é”éƒµè¼ª èå€«å¨œè™Ÿ", desc: "æ²–ç¹©ã€çŸ³å£å³¶5å¤©4å¤œè±ªè¯å‡æœŸã€‚é«”é©—ç¾©å¼é¢¨æƒ…æµ·ä¸Šç§»å‹•åŸå ¡ã€‚", price: 17900, img: "https://images.unsplash.com/photo-1548574505-5e239809ee19?w=800" },
            { id: 4, type: 'cruise', name: "åœ°ä¸­æµ·éƒµè¼ª æ¦®è€€è™Ÿ", desc: "åŸºéš†æ¸¯å‡ºç™¼æœ€ä¾¿åˆ©ã€‚æ–½è¯æ´›ä¸–å¥‡æ°´æ™¶æ¨“æ¢¯èˆ‡é ‚ç´šè¨­æ–½ã€‚", price: 21900, img: "https://static.liontech.com.tw/ConsoleAPData/PublicationStatic/lion_tw_b2c_event/zh-tw/cruise/_ModelFile/PictureAndText/1470534/bffedd5970744bd6a991d3f3cc36c083.jpg" },
            { id: 7, type: 'recommend', name: "æ—¥æœ¬åŒ—æµ·é“Â·æ¥µå…‰ç ´å†°èˆ¹", desc: "å†¬å­£é™å®šï¼šæ­ä¹˜ç ´å†°èˆ¹æ„Ÿå—å¤§æµ·éœ‡æ’¼ã€‚åŒ…å«æœ­å¹Œç™½è‰²ç‡ˆæ¨¹ç¯€ã€‚", price: 28900, img: "https://images.unsplash.com/photo-1542044896530-05d85be9b11a?w=800" },
            { id: 8, type: 'hotel', name: "äº¬éƒ½ éº—æ€å¡çˆ¾é “é…’åº—", desc: "åè½æ–¼é´¨å·ç•”ï¼Œé«”é©—å¤éƒ½å‚³çµ±ç¾å­¸èˆ‡ç¾ä»£æ¥µè‡´å¥¢è¯çš„å®Œç¾èåˆã€‚", price: 18500, img: "https://static.gltjp.com/glt/data/article/21000/20205/20230703_160551_f036a4c1_w1920.webp" },
            { id: 9, type: 'hotel', name: "æ˜Ÿé‡é›†åœ˜ RISONARE å°æ¿±å³¶", desc: "ä½æ–¼æ—¥æœ¬æœ€å—ç«¯å…«é‡å±±ç¾¤å³¶ï¼Œäº«æœ‰ç§äººæ²™ç˜èˆ‡ç’€ç’¨æ˜Ÿç©ºçš„åº¦å‡å¤©å ‚ã€‚", price: 12800, img: "https://images.unsplash.com/photo-1566073771259-6a8506099945?w=800" },
        ];

        let cartData = [];
        let currentUser = null;
        let usersDB = JSON.parse(localStorage.getItem('usc_users')) || {}; // æœ¬åœ°å„²å­˜æ‰€æœ‰ä½¿ç”¨è€…

        let detailModal, loginModal;

        window.onload = () => {
            detailModal = new bootstrap.Modal(document.getElementById('infoModal'));
            loginModal = new bootstrap.Modal(document.getElementById('loginModal'));

            // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥ (Session)
            const sessionUser = sessionStorage.getItem('usc_login_user');
            if (sessionUser && usersDB[sessionUser]) {
                currentUser = sessionUser;
                cartData = usersDB[currentUser].cart || [];
                updateUserUI();
            }

            renderItemsGrid('all');
            renderAllSynchronizedUI();
        };

        // --- æœƒå“¡é‚è¼¯ ---
        function handleRegister() {
            const user = document.getElementById('login-user').value.trim();
            const pass = document.getElementById('login-pass').value.trim();
            if (!user || !pass) return alert("è«‹è¼¸å…¥å¸³è™Ÿå¯†ç¢¼");
            if (usersDB[user]) return alert("æ­¤å¸³è™Ÿå·²è¢«è¨»å†Š");

            usersDB[user] = { password: pass, cart: [] };
            localStorage.setItem('usc_users', JSON.stringify(usersDB));
            alert("è¨»å†ŠæˆåŠŸï¼è«‹é‡æ–°é»æ“Šç™»å…¥ã€‚");
        }

        function handleLogin() {
            const user = document.getElementById('login-user').value.trim();
            const pass = document.getElementById('login-pass').value.trim();

            if (usersDB[user] && usersDB[user].password === pass) {
                currentUser = user;
                sessionStorage.setItem('usc_login_user', user);
                cartData = usersDB[currentUser].cart || [];

                loginModal.hide();
                updateUserUI();
                renderAllSynchronizedUI();
                alert(`æ­¡è¿å›ä¾†ï¼Œ${user}ï¼`);
            } else {
                alert("å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤");
            }
        }

        function handleLogout() {
            currentUser = null;
            sessionStorage.removeItem('usc_login_user');
            cartData = [];
            updateUserUI();
            renderAllSynchronizedUI();
            alert("å·²æˆåŠŸç™»å‡º");
        }

        function updateUserUI() {
            const loginNav = document.getElementById('login-nav-btn');
            const logoutNav = document.getElementById('logout-nav-btn');
            const userDisp = document.getElementById('user-display');
            if (currentUser) {
                loginNav.style.display = 'none';
                logoutNav.style.display = 'inline-block';
                userDisp.innerText = `ğŸ‘‹ ${currentUser}`;
            } else {
                loginNav.style.display = 'inline-block';
                logoutNav.style.display = 'none';
                userDisp.innerText = '';
            }
        }

        // --- UI åˆ‡æ›èˆ‡æ¸²æŸ“ ---
        function showTab(category) {
            document.querySelectorAll('.nav-link').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${category}-btn`).classList.add('active');

            const searchArea = document.getElementById('search-action-area');
            const cartArea = document.getElementById('pane-cart-display');
            const title = document.getElementById('grid-title');

            if (category === 'cart') {
                searchArea.style.display = 'none';
                cartArea.style.display = 'block';
                title.innerText = "æ‚¨çš„é é¸æ¸…å–®";
                renderAllSynchronizedUI();
            } else {
                searchArea.style.display = 'block';
                cartArea.style.display = 'none';
                const titleMap = { all: 'æ‰€æœ‰æ–¹æ¡ˆç²¾é¸', flight: 'ç†±é–€æ©Ÿç¥¨æ–¹æ¡ˆ', cruise: 'ç²¾é¸éƒµè¼ªèˆªç·š', hotel: 'ç†±é–€è¨‚æˆ¿å„ªæƒ ' };
                title.innerText = titleMap[category];
                renderItemsGrid(category);
            }
        }

        function renderItemsGrid(category) {
            const filtered = (category === 'all') ? travelDB : travelDB.filter(i => i.type === category);
            const grid = document.getElementById('main-items-grid');
            grid.innerHTML = filtered.map(item => `
                    <div class="col-md-4">
                        <div class="tour-card">
                            <img src="${item.img}" class="w-100" style="height:200px; object-fit:cover;" onerror="this.src='https://via.placeholder.com/400x300?text=Image'">
                            <div class="p-3 d-flex flex-column flex-grow-1">
                                <h5 class="fw-bold mb-2">${item.name}</h5>
                                <p class="text-muted small text-truncate mb-3">${item.desc}</p>
                                <div class="mt-auto d-flex justify-content-between align-items-center">
                                    <div class="price-text">NT$ ${item.price.toLocaleString()}</div>
                                    <button class="btn btn-outline-danger btn-sm" onclick="openDetail(${item.id})">æŸ¥çœ‹è©³æƒ…</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
        }

        function openDetail(id) {
            const item = travelDB.find(i => i.id === id);
            document.getElementById('m-image').src = item.img;
            document.getElementById('m-name').innerText = item.name;
            document.getElementById('m-text').innerText = item.desc;
            document.getElementById('m-price-val').innerText = `NT$ ${item.price.toLocaleString()}`;
            document.getElementById('m-buy-btn').onclick = () => { addItemToCart(item); detailModal.hide(); };
            detailModal.show();
        }

        // --- è³¼ç‰©è»Šæ ¸å¿ƒé‚è¼¯ ---
        function addItemToCart(item) {
            cartData.push({ ...item, cartId: Date.now() });
            saveCartToDB();
            renderAllSynchronizedUI();
            alert('å·²åŠ å…¥é é¸æ¸…å–®ï¼');
        }

        function removeFromCart(cartId) {
            cartData = cartData.filter(i => i.cartId !== cartId);
            saveCartToDB();
            renderAllSynchronizedUI();
        }

        function saveCartToDB() {
            if (currentUser) {
                usersDB[currentUser].cart = cartData;
                localStorage.setItem('usc_users', JSON.stringify(usersDB));
            }
        }

        function renderAllSynchronizedUI() {
            document.getElementById('cart-badge').innerText = cartData.length;

            const upperList = document.getElementById('upper-cart-list');
            const totalPriceEl = document.getElementById('cart-total-price');

            if (cartData.length === 0) {
                upperList.innerHTML = '<div class="text-center py-4 text-muted">ç›®å‰æ²’æœ‰è¡Œç¨‹</div>';
                totalPriceEl.style.display = 'none';
            } else {
                upperList.innerHTML = cartData.map(i => `
                        <div class="cart-item">
                            <span>${i.name}</span>
                            <div class="d-flex align-items-center">
                                <span class="text-danger fw-bold me-3">NT$ ${i.price.toLocaleString()}</span>
                                <i class="bi bi-trash text-muted" style="cursor:pointer" onclick="removeFromCart(${i.cartId})"></i>
                            </div>
                        </div>
                    `).join('');

                const total = cartData.reduce((sum, item) => sum + item.price, 0);
                totalPriceEl.innerHTML = `ç¸½åƒ¹æ ¼ï¼šNT$ ${total.toLocaleString()}`;
                totalPriceEl.style.display = 'block';
            }

            // åŒæ­¥ä¸‹æ–¹çš„æ–¹æ¡ˆå¡ç‰‡ (å¦‚æœæ˜¯é é¸åˆ†é )
            if (document.getElementById('tab-cart-btn').classList.contains('active')) {
                const grid = document.getElementById('main-items-grid');
                if (cartData.length === 0) {
                    grid.innerHTML = '<div class="col-12 text-center py-5 text-muted">ç›®å‰æ²’æœ‰è¡Œç¨‹</div>';
                } else {
                    grid.innerHTML = cartData.map(item => `
                            <div class="col-md-4">
                                <div class="tour-card">
                                    <img src="${item.img}" class="w-100" style="height:200px; object-fit:cover;">
                                    <div class="p-3 d-flex flex-column flex-grow-1">
                                        <h5 class="fw-bold mb-2">${item.name}</h5>
                                        <div class="mt-auto d-flex justify-content-between align-items-center">
                                            <div class="price-text">NT$ ${item.price.toLocaleString()}</div>
                                            <button class="btn btn-dark btn-sm" onclick="removeFromCart(${item.cartId})">ç§»é™¤æ­¤é …</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                }
            }
        }

        function performSearch() {
            const kw = document.getElementById('keyword-input').value.toLowerCase();
            const results = travelDB.filter(i => i.name.toLowerCase().includes(kw));
            const grid = document.getElementById('main-items-grid');
            document.getElementById('grid-title').innerText = `æœå°‹çµæœ: "${kw}"`;

            if (results.length === 0) {
                grid.innerHTML = '<div class="col-12 text-center py-5">æ‰¾ä¸åˆ°ç›¸é—œæ–¹æ¡ˆ</div>';
            } else {
                grid.innerHTML = results.map(item => `
                        <div class="col-md-4">
                            <div class="tour-card">
                                <img src="${item.img}" class="w-100" style="height:200px; object-fit:cover;">
                                <div class="p-3 d-flex flex-column flex-grow-1">
                                    <h5 class="fw-bold mb-2">${item.name}</h5>
                                    <div class="mt-auto d-flex justify-content-between align-items-center">
                                        <div class="price-text">NT$ ${item.price.toLocaleString()}</div>
                                        <button class="btn btn-outline-danger btn-sm" onclick="openDetail(${item.id})">æŸ¥çœ‹è©³æƒ…</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
            }
        }

        // --- CSV åŒ¯å‡ºåŠŸèƒ½ ---
        function exportCartToCSV() {
            if (cartData.length === 0) return alert("è³¼ç‰©è»Šç›®å‰æ˜¯ç©ºçš„");

            let csvContent = "\uFEFF"; // BOM é¿å…äº‚ç¢¼
            csvContent += "å¸³è™Ÿ,ç”¢å“åç¨±,åƒ¹æ ¼,åŠ å…¥æ™‚é–“\n";

            cartData.forEach(item => {
                const time = new Date(item.cartId).toLocaleString();
                const row = `${currentUser || 'æœªç™»å…¥è¨ªå®¢'},${item.name},${item.price},${time}\n`;
                csvContent += row;
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.setAttribute("download", `USC_Cart_${currentUser || 'Guest'}_${new Date().toLocaleDateString()}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
